(function(){var t,e,o,i,n,s=[].slice;t=jQuery,window,document,t.fn.extend({sidenotes:function(){var e,o;return o=arguments[0],e=2<=arguments.length?s.call(arguments,1):[],this.each((function(){var n,s,r;return s=null!=(r=(n=t(this)).data("sidenotes"))?r:n.data("sidenotes",new i(this,o)),"string"==typeof o&&(s[o].apply(s,e),"destroy"===o&&n.removeData("sidenotes")),!0}))}}),i=function(){function i(i,n){var s,r;this.options=t.extend({},this.options,n),this.options.sidenotePlacement=this.options.placement||this.options.sidenotePlacement,this.options.hideFootnoteContainer&&(this.$footnoteContainer=t(this.options.footnoteContainerSelector,i)),this.$footnoteContainer=0!==this.$footnoteContainer.length?this.$footnoteContainer:null,null==this.$footnoteContainer?t(".text").removeClass("sidenotes_present"):(t(".text").addClass("sidenotes_present"),this.$postContainer=this.$footnoteContainer.parent(),this.$footnotes=t(this.options.footnoteContainerSelector+" "+this.options.footnoteSelector,this.$postContainer),this.sidenotesAfterRef="after"===this.options.sidenotePlacement,r=1,this.sidenotes=[],this.groups=[],s=this,this.$footnotes.each((function(){var t,i,n,h,d,a;if(t=this.id,n=s.options.removeRefMarkRegex.test(t),d=new e(this,n?null:r++,s),s.sidenotes.push(d),null!=(h=null!=(a=s.sidenotes[s.sidenotes.length-2])?a:null)?h.$pivot.is(d.$pivot):void 0)return h.hasGroup()?h.group.push(d):(i=new o([h,d],s),s.groups.push(i))})),this.isHidden=this.options.initiallyHidden,this.isHidden?this.hide(!0):this.show(!0))}return i.prototype.options={footnoteContainerSelector:".footnotes",footnoteSelector:"> ol > li",initiallyHidden:!1,removeRefMarkRegex:/(?!)/,refMarkClass:"ref-mark",sidenoteClass:"sidenote",sidenoteGroupClass:"sidenote-group",sidenoteElement:"aside",sidenoteGroupElement:"div",sidenotePlacement:"before",hideFootnoteContainer:!0,formatSidenote:function(e,o,i){var n;return n=t("<"+this.sidenoteElement+"/>",{class:this.sidenoteClass}).html(e).attr("id",o),null!=i&&(n.attr("data-ref",i),n.prepend(t("<span/>",{class:this.refMarkClass}).html(i))),n},formatSidenoteID:function(t){return t.replace(/^f/,"s")},hide:function(t){return t.hide()},show:function(t){return t.show()}},i.prototype.show=function(t){var e,o,i,n,s,r,h,d;if(this.isHidden||t){for(i=0,s=(h=this.sidenotes).length;i<s;i++)o=h[i],t&&!o.hasGroup()&&o.$pivot[this.sidenotePlacement()](o.$sidenote),o.show();for(n=0,r=(d=this.groups).length;n<r;n++)e=d[n],t&&e.$pivot[this.sidenotePlacement()](e.$group),e.show();return null!=this.$footnoteContainer&&this.options.hideFootnoteContainer&&this.options.hide(this.$footnoteContainer),this.isHidden=!1}},i.prototype.hide=function(t){var e,o,i,n,s,r,h,d;if(!this.isHidden||t){for(i=0,s=(h=this.sidenotes).length;i<s;i++)o=h[i],t&&!o.hasGroup()&&o.$pivot[this.sidenotePlacement()](o.$sidenote),o.hide();for(n=0,r=(d=this.groups).length;n<r;n++)e=d[n],t&&e.$pivot[this.sidenotePlacement()](e.$group),e.hide();return null!=this.$footnoteContainer&&this.options.show(this.$footnoteContainer),this.isHidden=!0}},i.prototype.sidenotePlacement=function(t,e){var o,i,n,s,r,h,d,a;if("before"!==t&&"after"!==t||t===this.sidenotePlacement()&&!e)return this.sidenotesAfterRef?"after":"before";for(n=0,r=(d=this.sidenotes).length;n<r;n++)(i=d[n]).hasGroup()||i.$pivot[t](i.$sidenote);for(s=0,h=(a=this.groups).length;s<h;s++)(o=a[s]).$pivot[t](o.$group);return this.sidenotesAfterRef="after"===t},i.prototype.placement=function(t,e){return this.sidenotePlacement(t,e)},i.prototype.destroy=function(){var t,e,o,i,n,s,r,h;for(this.hide(),e=0,i=(s=this.sidenotes).length;e<i;e++)s[e].$sidenote.remove();for(h=[],o=0,n=(r=this.groups).length;o<n;o++)t=r[o],h.push(t.$group.remove());return h},i}(),e=function(){function e(e,o,i){var s,r,h,d,a,p;if(this.$footnote=t(e),this.owner=i,this.footnoteID=e.id,this.sidenoteID=this.owner.options.formatSidenoteID(this.footnoteID),this.ref=o>0?o:null,this.$refMarkAnchor=t("a[href='#"+n(this.footnoteID)+"']",this.owner.$postContainer),this.$refMarkSup=this.$refMarkAnchor.parent("sup"),this.$refMarkSup=0!==this.$refMarkSup.length?this.$refMarkSup:null,this.isNested=t.contains(this.owner.$footnoteContainer.get(0),this.refMark().get(0)),this.isNested)for(r=this.refMark().closest(this.owner.$footnotes),d=0,a=(p=this.owner.sidenotes).length;d<a;d++)if((h=p[d]).$footnote.is(r)){this.referringSidenote=h;break}this.refMarkID=this.refMark().attr("id"),this.originalRef=this.$refMarkAnchor.html(),this.$sidenote=this.owner.options.formatSidenote(this.$footnote.html(),this.sidenoteID,this.ref),this.$pivot=this.isNested?this.referringSidenote.$pivot:this.refMark().parentsUntil(this.owner.$postContainer).last(),this.group=null,null!=(s=t("a[href='#"+n(this.refMarkID)+"']",this.$sidenote))&&this.noMark()&&this.owner.options.hide(s),this.owner.options.hide(this.$sidenote),this.isHidden=!0}return e.prototype.noMark=function(){return null==this.ref},e.prototype.hasGroup=function(){return null!=this.group},e.prototype.show=function(t){if(this.isHidden||t)return this.noMark()?this.owner.options.hide(this.refMark()):(this.$refMarkAnchor.html(this.ref),this.$refMarkAnchor.attr("href","#"+this.sidenoteID)),this.owner.options.show(this.$sidenote),this.owner.options.hide(this.$footnote),this.isHidden=!1},e.prototype.hide=function(t){if(!this.isHidden||t)return this.$refMarkAnchor.html(this.originalRef),this.$refMarkAnchor.attr("href","#"+this.footnoteID),this.owner.options.show(this.refMark()),this.owner.options.hide(this.$sidenote),this.owner.options.show(this.$footnote),this.isHidden=!0},e.prototype.refMark=function(){var t;return null!=(t=this.$refMarkSup)?t:this.$refMarkAnchor},e}(),o=function(){function e(e,o){var i;this.sidenotes=[],this.owner=o,this.$group=t("<"+this.owner.options.sidenoteGroupElement+"/>",{class:this.owner.options.sidenoteGroupClass}),this.push(e),this.$pivot=null!=(i=this.sidenotes[0])?i.$pivot:void 0,this.owner.options.hide(this.$group),this.isHidden=!0}return e.prototype.push=function(t){var e,o,i,n,s;for(o=t instanceof Array?t:[t],(s=this.sidenotes).push.apply(s,o),i=0,n=o.length;i<n;i++)e=o[i],this.$group.append(e.$sidenote),e.group=this;return null!=this.$pivot?this.$pivot:this.$pivot=this.sidenotes[0].pivot},e.prototype.show=function(){if(this.isHidden)return this.owner.options.show(this.$group),this.isHidden=!1},e.prototype.hide=function(){if(!this.isHidden)return this.owner.options.hide(this.$group),this.isHidden=!0},e}(),n=function(t){return t.replace(/([#;&,\.\+\*\~':"\!\^$\[\]\(\)=>\|])/g,"\\$1")}}).call(this);